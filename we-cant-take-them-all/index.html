<html>

<head>

  </head>

<body>

<button type="button" id="german" onclick="oppositionVoiced(this.id)">I am German and I don't think that we should admit any more Afghans.</button><br>


  <p id="p2"> </p>


<script>

/*
<button type="button" id="finnish" onclick="oppositionVoiced(this.id)">I am Finnish and I don't think that we should admit any more Somalis.</button><br>
<button type="button" id="english" onclick="oppositionVoiced(this.id)">I am English and I don't think that we should admit any more Romanians.</button><br>
<button type="button" id="american" onclick="oppositionVoiced(this.id)">I am American and I don't think that we should admit any more Mexicans.</button>
*/

var information = "This is a combinatory artwork based on a text written by professor of Political Science Joseph Carens. " +
"Joseph Carens wrote this text as a generalisation of sentiments by those opposed to admitting Jewish refugees into America during world war II." +
"The purpose of this piece is to raise awareness about the similarities in discourse utilised across various instances of anti refugee logic."

//select sentences which fit together quite nicely.
//and make four different states, ie. that combine These
//for example: "what is happening.. is too bad.. we have our own problems"
//plus a random sentence
//Or: Times are tough here, we have an obligation to look out for our own needy first
//and then something else.
//I need to think about this a little bit more...

//Joseph Carens' generalisation is presented as an array, with some sentencess
//grouped into the same index because they belong together.
var carensGeneralisation = [
"What is happening to the Jews is too bad, but it's not our fault. " +
"We have our own problems. ",
"If we take in all the Jews who want to come, we will be overwhelmed. " +
"There are simply too many of them. ",
"Besides, while Jews may be subject to discrimination and occasional acts of violence, things are not as bad as their advocacy groups say. " +
"They exaggerate the problem. ",
"Many of the Jews just want better economic opportunities than they have at home. " +
"The ones who manage to make it to North America cannot be among the worst off because they have enough economic resources to cross the Atlantic. ",
"Times are tough here. " +
"We have an obligation to look out for our own needy first. ",
"A large infux of Jews could be a cultural and political threat. " +
"They don't share our religious traditions or our democractic values. ",
"Some of them are communists and pose a basic security threat, but it's hard to be sure which ones, so it's better to err on the side of caution in restricting entry. ",
"Many of them have shown that they don't respect the law because they they have purchased forged documents, hired smugglers to transport them illegally, and lied to our immigration officials. ",
"Admitting Jewish refugees does not help to address the underlying problems that have given rise to the Nazi phenomenon."
];

console.log(carensGeneralisation);

var me = {};
var refugees = {};
var refugeeSituation = {};

//For the purposes of this code, 'me' is characterised by my nationality and my scaryOther,
//the "Other" which I am scared of
//me = {nationality:"", scaryOther:""};

//For the purposes of this code, 'refugee' is characterised by their nationality,
//the geographicalObstacle they face while fleeing, and finally, the promisedLand,
//ie. the nation which the refugee hopes will become a cradle for a better life
//refugees = {nationality:"", opressor:"", geographicalObstacle:"", promisedLand:""};

//For the purposes of this code, a refugeeSituation is characterised by the
//relationship between me and the refugees.
//refugeeSituation = {me: me, refugees: refugees};

//var someRefugeeSituations = {};

//try to figure out how to create the 'refugeeSituation', 'me' and 'refugee' objects
me = {nationality:"german",scaryOther:"muslim extremists"};
refugees = {nationality:"Afghan", opressor:"taleban", geographicalObstacle:"Mediterranean", promisedLand:"Germany"};
refugeeSituation = {me: me, refugees: refugees};

var synth = window.speechSynthesis;
var speakThis = new SpeechSynthesisUtterance;
//speakThis.lang = setLanguage();
speakThis.text = '';

/*
someRefugeeSituations = {
  situation1: {me:{nationality:"german",scaryOther:"muslim extremists"},refugees:{nationality:"Afghans", opressor:"taleban", geographicalObstacle:"Mediterranean", promisedLand:"Germany"}},
  me:{nationality:"finnish",scaryOther:"muslim extremists"},refugees:{nationality:"Somalis", opressor:"boko haram", geographicalObstacle:"Sahara", promisedLand:"Finland"},
  me:{nationality:"english",scaryOther:"criminals"},refugees:{nationality:"Romanians", opressor:"corrupt government", geographicalObstacle:"English channel", promisedLand:"England"},
  me:{nationality:"american",scaryOther:"criminals"},refugees:{nationality:"Venezuelans", opressor:"Maduro regime", geographicalObstacle:"The Mexican border", promisedLand:"America"}
};

console.log(someRefugeeSituations.situation1.me + "<br>" + someRefugeeSituations[3].refugees.opressor);
/*

/*
var someSampleRefugeeSituations{
  {nationalityMe:"german", nationalityRefugees:"Afghans", promisedLand:"Germany", geographicalObstacle:"Mediterranean", scaryOther:"extremists", opressor:"taleban"},
  {nationalityMe:"finnish", nationalityRefugees:"Somalis", promisedLand:"Finland", geographicalObstacle:"Sahara", scaryOther:"extremists", opressor:"boko haram"},
  {nationalityMe:"english", nationalityRefugees:"Romanians", promisedLand:"England", geographicalObstacle:"English channel", scaryOther:"criminals", opressor:"corrupt government"},
  {nationalityMe:"american", nationalityRefugees:"Venezuelans", promisedLand:"America", geographicalObstacle:"the Mexican border", scaryOther:"criminals", opressor:"Maduro regime"}
};
*/

function oppositionVoiced(myNationality){
  //nationality becomes the voice of the speechSynthesizer;
  //depending on nationality, we replace the variables refugeeNationality, promisedLand, geographicObstacle, scaryOther, opressor;
  //these should all exist in an array identified by the nationality of the local who is opposed to refugees.

  //me.nationality = myNationality;
  //populateTheRefugeeSituation(myNationality);

  var myFullandHonestOpinion = replaceCarensGeneralisationWith(refugeeSituation);
  var myBriefOpinion = chooseSomeSentencesFrom(myFullandHonestOpinion);
  speakMyOpinion(me.nationality, myBriefOpinion);

/*
  for(i=0; i<someRefugeeSituations.length; i++){
    if(me.nationality == someRefugeeSituations[i].me.nationality){
      var oneRefugeeSituation = someRefugeeSituations[i];
      populateTheRefugeeSituation(oneRefugeeSituation);
      var myOpinion = replaceCarensGeneralisationWith(refugeeSituation);
      speakMyOpinion(me.nationality, myOpinion);
    }
  }*/

  function populateTheRefugeeSituation(sampleRefugeeSituation){
    me.nationality = sampleRefugeeSituation.me.nationality;
    me.scaryOther = sampleRefugeeSituation.me.scaryOther;
    refugees.nationality = sampleRefugeeSituation.refugees.nationality;
    refugees.opressor = sampleRefugeeSituation.refugees.opressor;
    refugees.geographicalObstacle = sampleRefugeeSituation.refugees.geographicalObstacle;
    refugees.promisedLand = sampleRefugeeSituation.refugees.promisedLand;
    refugeeSituation = {me, refugees};
  };//end of populateTheRefugeeSituation

  function replaceCarensGeneralisationWith(refugeeSituation){
    var myOpinion = [];
    //we need to create a for loop that loops through carensGeneralisation
    //and replaces elements in the strings at each index
    for (var i = 0; i < carensGeneralisation.length; i++) {
      myOpinion[i] = carensGeneralisation[i].replace("Jewish", refugeeSituation.refugees.nationality);
      myOpinion[i] = myOpinion[i].replace(/Jew/g, refugeeSituation.refugees.nationality);
      myOpinion[i] = myOpinion[i].replace("North America", refugeeSituation.refugees.promisedLand);
      myOpinion[i] = myOpinion[i].replace("Atlantic", refugeeSituation.refugees.geographicalObstacle);
      myOpinion[i] = myOpinion[i].replace("communists", refugeeSituation.me.scaryOther);
      myOpinion[i] = myOpinion[i].replace(/Nazi/g, refugeeSituation.refugees.opressor);
      console.log(myOpinion[i]);
    }//end of replaceCarensGeneralisationWith
    return myOpinion;
  }//end of replaceCarensGeneralisationWith()

  function chooseSomeSentencesFrom(myFullandHonestOpinion){
    var someSentences = [];//keep it as an array!
    someSentences[0] = myFullandHonestOpinion[0];
    //returns a random integer between 1 and length of array - 1
    var randomIndex = Math.floor(Math.random() * (myFullandHonestOpinion.length-1)) + 1;
    console.log("randomIndex is:" + randomIndex);
    someSentences[1] = myFullandHonestOpinion[randomIndex];
    console.log(someSentences);
    return someSentences;
  }//end of chooseSomeSentencesFrom()

  function speakMyOpinion(language, opinion){
    console.log("Language is: " + language + " and opinion is: " + opinion);
    //create a way to map me.nationality to the right lang code for the synthesiser
    speakThis.lang = "de-DE";

    /*speakThis.text = opinion[0];
    synth.speak(speakThis);
    synth.pause();*/

    speakOneSentence(opinion[0]).then(value => speakOneSentence(opinion[1]));

    function speakOneSentence(sentence){
      return new Promise(function(resolve, reject){
        speakThis.text = sentence;
        synth.speak(speakThis);
        //synth.resume();
        var para = document.createElement("p");
        var node = document.createTextNode(sentence);
        para.appendChild(node);
        console.log('adding text content to p2:' + sentence);
        document.getElementById("p2").innerHTML = para.innerHTML;
        console.log('added text content to p2');
        /*var amISpeaking = synth.speaking;
        if (!amISpeaking){
          console.log('deleting text content');
          document.getElementById("p2").innerHTML = "";
          console.log('deleted text content');
          //console.log('Utterance has finished being spoken after ' + event.elapsedTime + ' milliseconds.');
          resolve('resolved the promise');
        }*/
        speakThis.onend = function(event) {
          console.log('deleting text content');
          document.getElementById("p2").innerHTML = "";
          console.log('deleted text content');
          console.log('Utterance has finished being spoken after ' + event.elapsedTime + ' milliseconds.');
          resolve();
        };

      });//end of return new Promise

    }//end of speakOneSentence


    /*speakThis.text = opinion[0];
    synth.speak(speakThis);

    speakThis.text = opinion[1];
    synth.speak(speakThis);*/


    /*speakThis.onend = function(event) {
      document.getElementById("p2").innerHTML = "";
      console.log('deleting text content');
      console.log('Utterance has finished being spoken after ' + event.elapsedTime + ' milliseconds.');
    }*/

    //var element = document.getElementById("transcriptDiv");
    //element.appendChild(para);



  };//end of speakMyOpinion()

}//end of oppositionVoiced





</script>

</body>


</html>
